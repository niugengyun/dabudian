<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¤§ä¸ç‚¹</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }
        /* å·¦ä¾§æŒ‰é’®æ æ ·å¼ */
        .sidebar {
            width: 64px;
            height: 100%;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            box-shadow: 1px 0 5px rgba(0, 0, 0, 0.1);
        }
        .sidebar-btn {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            border-radius: 12px;
            border: none;
            background-color: white;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        .sidebar-btn:hover {
            background-color: #e6f7ff;
            transform: translateY(-2px);
        }
        .sidebar-btn:active {
            transform: translateY(0);
        }
        .sidebar-icon {
            font-size: 20px;
            margin-bottom: 0;
        }
        .sidebar-text {
            font-size: 12px;
            color: #333;
        }
        /* å³ä¾§å†…å®¹åŒºåŸŸæ ·å¼ */
        .content {
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        /* æ ‡ç­¾é¡µå®¹å™¨ */
        .tabs-container {
            display: flex;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ddd;
            height: 40px;
            align-items: center;
            padding: 0 8px;
        }
        /* æ ‡ç­¾é¡µ */
        .tab {
            display: flex;
            align-items: center;
            padding: 0 12px;
            height: 32px;
            background-color: #e0e0e0;
            border-radius: 6px 6px 0 0;
            margin-right: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            white-space: nowrap;
            max-width: 160px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .tab.active {
            background-color: #fff;
            font-weight: 500;
        }
        .tab-close {
            margin-left: 8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }
        .tab-close::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' stroke='white' stroke-width='2'%3E%3Cpath d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .tab-close:hover {
            background-color: #999;
        }
        /* æ–°å¢æ ‡ç­¾æŒ‰é’® */
        .new-tab {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            cursor: pointer;
            font-size: 16px;
            color: #666;
        }
        .new-tab:hover {
            background-color: #ddd;
        }
        /* Webview å®¹å™¨ */
        .webview-container {
            flex: 1;
            position: relative;
        }
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 300px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            border-bottom: 1px solid #e8e8e8;
            padding-bottom: 8px;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 500;
        }
        .form-item {
            margin-bottom: 16px;
        }
        .form-item label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        select {
            width: 100%;
            height: 32px;
            padding: 4px 11px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
        }
        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 16px;
        }
        .btn {
            height: 32px;
            padding: 4px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            border: 1px solid #d9d9d9;
            background: white;
            color: rgba(0, 0, 0, 0.88);
            font-size: 14px;
        }
        .btn:hover {
            border-color: #4096ff;
            color: #4096ff;
        }
        .btn-primary {
            background: #1677ff;
            color: white;
            border: none;
        }
        .btn-primary:hover {
            background: #4096ff;
            color: white !important;
            border: none;
        }
        .webview-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
        }
        .webview-wrapper.active {
            display: block;
        }
        .webview {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§æŒ‰é’®æ  -->
    <div class="sidebar">
        <button class="sidebar-btn" id="addButton">
            <span class="sidebar-icon">+</span>
            <span class="sidebar-text">æ·»åŠ </span>
        </button>
        <button class="sidebar-btn" id="serviceButton">
            <span class="sidebar-icon">ğŸ‘¨â€ğŸ’»</span>
            <span class="sidebar-text">å®¢æœ</span>
        </button>
        <button class="sidebar-btn" id="settingsButton">
            <span class="sidebar-icon">âš™ï¸</span>
            <span class="sidebar-text">è®¾ç½®</span>
        </button>
        <button class="sidebar-btn" id="aboutButton">
            <span class="sidebar-icon">â„¹ï¸</span>
            <span class="sidebar-text">å…³äº</span>
        </button>
    </div>
    
    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <!-- æ ‡ç­¾é¡µæ  -->
        <div class="tabs-container" id="tabsContainer">
            <!-- è¿™é‡Œå°†åŠ¨æ€æ·»åŠ æ ‡ç­¾é¡µ -->
            <div class="new-tab" id="newTabButton">+</div>
        </div>
        
        <!-- Webview å®¹å™¨ -->
        <div class="webview-container" id="webviewContainer">
            <!-- è¿™é‡Œå°†åŠ¨æ€æ·»åŠ  webview -->
        </div>
    </div>

    <script>
        console.log('ä¸»çª—å£å·²åŠ è½½');
        
        // å…¨å±€å˜é‡
        let tabCounter = 0;
        let tabs = [];
        let activeTabId = null;
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆåæ³¨å†Œç›‘å¬å™¨
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('ä¸»çª—å£ DOM åŠ è½½å®Œæˆ');
            
            // ä½¿ç”¨ preload æš´éœ²çš„ API
            if (window.electronAPI) {
                console.log('electronAPI å¯ç”¨');
                
                // åŠ è½½æŒä¹…åŒ–çš„æ ‡ç­¾é¡µæ•°æ®
                const tabsData = await window.electronAPI.loadTabsData();
                console.log('åŠ è½½åˆ°çš„æ ‡ç­¾é¡µæ•°æ®:', tabsData);
                
                // å¦‚æœæœ‰æŒä¹…åŒ–çš„æ ‡ç­¾é¡µæ•°æ®ï¼Œåˆ›å»ºå¯¹åº”çš„æ ‡ç­¾é¡µ
                if (tabsData && tabsData.tabs && tabsData.tabs.length > 0) {
                    tabsData.tabs.forEach(tab => {
                        createTabFromData(tab);
                    });
                }
                
                // ç›‘å¬æ ‡ç­¾é¡µæ·»åŠ äº‹ä»¶
                window.electronAPI.onTabAdded((tab) => {
                    console.log('æ”¶åˆ°æ–°æ ‡ç­¾é¡µæ•°æ®:', tab);
                    createTabFromData(tab);
                });
                
                // ç›‘å¬æ ‡ç­¾é¡µåˆ é™¤äº‹ä»¶
                window.electronAPI.onTabRemoved((tabId) => {
                    console.log('æ”¶åˆ°æ ‡ç­¾é¡µåˆ é™¤äº‹ä»¶:', tabId);
                    removeTab(tabId);
                });
                
                // ç›‘å¬æ ‡ç­¾é¡µæ›´æ–°äº‹ä»¶
                window.electronAPI.onTabUpdated((tab) => {
                    console.log('æ”¶åˆ°æ ‡ç­¾é¡µæ›´æ–°äº‹ä»¶:', tab);
                    updateTab(tab);
                });

                // ç›‘å¬å¯¼èˆªåˆ°ä¸»é¡µäº‹ä»¶
                window.electronAPI.onNavigateToHome(() => {
                    console.log('æ”¶åˆ°å¯¼èˆªåˆ°ä¸»é¡µäº‹ä»¶');
                    const webview = document.getElementById(activeTabId);
                    if (webview) {
                        webview.src = 'https://zs.kwaixiaodian.com/page/helper?from=seller_pc_home_page';
                    }
                });

                // ç›‘å¬åˆ·æ–°æ ‡ç­¾é¡µäº‹ä»¶
                window.electronAPI.onRefreshActiveTab(() => {
                    console.log('æ”¶åˆ°åˆ·æ–°æ ‡ç­¾é¡µäº‹ä»¶');
                    const webview = document.getElementById(activeTabId);
                    if (webview) {
                        webview.reload();
                    }
                });

                // ç›‘å¬è°ƒè¯•æ¨¡å¼åˆ‡æ¢äº‹ä»¶
                window.electronAPI.onToggleDebugMode(() => {
                    console.log('æ”¶åˆ°åˆ‡æ¢è°ƒè¯•æ¨¡å¼äº‹ä»¶');
                    const webview = document.getElementById(activeTabId);
                    if (webview) {
                        if (webview.isDevToolsOpened()) {
                            webview.closeDevTools();
                        } else {
                            webview.openDevTools();
                        }
                    }
                });

                // ç›‘å¬æ˜¾ç¤ºé€€å‡ºæ¨¡æ€æ¡†äº‹ä»¶
                window.electronAPI.onShowLogoutModal(() => {
                    console.log('æ”¶åˆ°æ˜¾ç¤ºé€€å‡ºæ¨¡æ€æ¡†äº‹ä»¶');
                    showLogoutModal();
                });

                // ç›‘å¬æ˜¾ç¤ºè®¾ç½®æ¨¡æ€æ¡†äº‹ä»¶
                window.electronAPI.onShowSettingsModal(() => {
                    console.log('æ”¶åˆ°æ˜¾ç¤ºè®¾ç½®æ¨¡æ€æ¡†äº‹ä»¶');
                    showSettingsModal();
                });
            } else {
                console.error('electronAPI ä¸å¯ç”¨');
            }

            // æ·»åŠ æ–°æ ‡ç­¾æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('newTabButton').addEventListener('click', () => {
                if (window.electronAPI) {
                    window.electronAPI.sidebarAction('add');
                }
            });

            // æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('addButton').addEventListener('click', () => {
                console.log('ç‚¹å‡»æ·»åŠ æŒ‰é’®');
                if (window.electronAPI) {
                    window.electronAPI.sidebarAction('add');
                }
            });

            document.getElementById('serviceButton').addEventListener('click', () => {
                console.log('ç‚¹å‡»å®¢æœæŒ‰é’®');
                if (window.electronAPI) {
                    window.electronAPI.sidebarAction('service');
                }
            });

            document.getElementById('settingsButton').addEventListener('click', () => {
                console.log('ç‚¹å‡»è®¾ç½®æŒ‰é’®');
                if (window.electronAPI) {
                    window.electronAPI.sidebarAction('settings');
                }
            });

            document.getElementById('aboutButton').addEventListener('click', () => {
                console.log('ç‚¹å‡»å…³äºæŒ‰é’®');
                if (window.electronAPI) {
                    window.electronAPI.sidebarAction('about');
                }
            });
        });
        
        // ä»æ•°æ®åˆ›å»ºæ ‡ç­¾é¡µ
        function createTabFromData(tabData) {
            console.log('åˆ›å»ºæ ‡ç­¾é¡µ:', tabData);
            const tabId = tabData.id;
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒ ID çš„æ ‡ç­¾é¡µ
            if (tabs.some(tab => tab.id === tabId)) {
                console.log('æ ‡ç­¾é¡µå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º:', tabId);
                return;
            }
            
            // åˆ›å»ºæ ‡ç­¾é¡µå…ƒç´ 
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.tabId = tabId;
            tab.innerHTML = `
                <span class="tab-title">${tabData.remark}</span>
                <span class="tab-close"></span>
            `;
            
            // åˆ›å»º webview å…ƒç´ 
            const webviewWrapper = document.createElement('div');
            webviewWrapper.className = 'webview-wrapper';
            webviewWrapper.dataset.tabId = tabId;
            
            const webview = createWebviewElement(tabData);
            
            // æ·»åŠ  webview åŠ è½½å®Œæˆäº‹ä»¶ç›‘å¬
            webview.addEventListener('dom-ready', () => {
                console.log(`webview ${tabData.id} åŠ è½½å®Œæˆ`);
                // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µï¼Œç¡®ä¿å®ƒæ˜¾ç¤º
                if (tabs.length === 1) {
                    webviewWrapper.style.display = 'block';
                }
            });
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            tab.addEventListener('click', () => {
                console.log('ç‚¹å‡»æ ‡ç­¾é¡µ:', tabId);
                switchTab(tabId, true);  // æ˜ç¡®æŒ‡å®šæ˜¯ç”¨æˆ·ç‚¹å‡»
            });
            tab.addEventListener('dblclick', () => {
                if (window.electronAPI) {
                    window.electronAPI.editTab(tabId);
                }
            });
            tab.querySelector('.tab-close').addEventListener('click', (e) => {
                e.stopPropagation();
                
                // æ£€æŸ¥æ˜¯å¦åªå‰©ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µï¼Œå¦‚æœæ˜¯åˆ™ç¦æ­¢å…³é—­
                if (tabs.length <= 1) {
                    alert('æ— æ³•å…³é—­æœ€åä¸€ä¸ªæ ‡ç­¾é¡µ');
                    return;
                }
                
                if (window.electronAPI) {
                    window.electronAPI.showConfirmDialog('ç¡®è®¤å…³é—­', 'ç¡®å®šè¦å…³é—­è¿™ä¸ªæ ‡ç­¾é¡µå—ï¼Ÿ')
                        .then(confirmed => {
                            if (confirmed) {
                                window.electronAPI.removeTab(tabId);
                            }
                        });
                } else {
                    removeTab(tabId);
                }
            });
            
            // æ·»åŠ åˆ° DOM
            document.getElementById('tabsContainer').insertBefore(tab, document.getElementById('newTabButton'));
            webviewWrapper.appendChild(webview);
            document.getElementById('webviewContainer').appendChild(webviewWrapper);
            
            // æ›´æ–°æ•°æ®
            tabs.push({
                id: tabId,
                element: tab,
                webview: webview,
                data: tabData
            });
            
            console.log('æ ‡ç­¾é¡µåˆ›å»ºå®Œæˆ:', tabId);
            
            // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µï¼Œæ¿€æ´»å®ƒ
            if (tabs.length === 1) {
                switchTab(tabId);
            }
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId, isUserClick = false) {
            console.log('åˆ‡æ¢æ ‡ç­¾é¡µ:', tabId, isUserClick ? '(ç”¨æˆ·ç‚¹å‡»)' : '(åˆå§‹åŒ–)');
            // æ›´æ–°æ´»åŠ¨æ ‡ç­¾é¡µ
            tabs.forEach(tab => {
                if (tab.id === tabId) {
                    tab.element.classList.add('active');
                    tab.webview.parentElement.classList.add('active');
                    tab.webview.parentElement.style.display = 'block';  // ç¡®ä¿æ˜¾ç¤º
                    activeTabId = tabId;
                    
                    // åªåœ¨ç”¨æˆ·ç‚¹å‡»æ—¶é€šçŸ¥ä¸»è¿›ç¨‹æ›´æ–°æ´»åŠ¨çš„webview
                    if (isUserClick && window.electronAPI) {
                        window.electronAPI.updateActiveWebview(tabId);
                    }
                } else {
                    tab.element.classList.remove('active');
                    tab.webview.parentElement.classList.remove('active');
                    tab.webview.parentElement.style.display = 'none';  // éšè—å…¶ä»–æ ‡ç­¾é¡µ
                }
            });
        }
        
        // åˆ é™¤æ ‡ç­¾é¡µ
        function removeTab(tabId) {
            // æ‰¾åˆ°è¦åˆ é™¤çš„æ ‡ç­¾é¡µ
            const tabIndex = tabs.findIndex(tab => tab.id === tabId);
            if (tabIndex === -1) return;
            
            // ä» DOM ä¸­ç§»é™¤
            tabs[tabIndex].element.remove();
            tabs[tabIndex].webview.parentElement.remove();
            
            // ä»æ•°ç»„ä¸­ç§»é™¤
            tabs.splice(tabIndex, 1);
            
            // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µï¼Œæ¿€æ´»ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µ
            if (activeTabId === tabId && tabs.length > 0) {
                switchTab(tabs[0].id);
            }
        }

        // æ›´æ–°æ ‡ç­¾é¡µ
        function updateTab(tabData) {
            // æ‰¾åˆ°è¦æ›´æ–°çš„æ ‡ç­¾é¡µ
            const tab = tabs.find(tab => tab.id === tabData.id);
            if (!tab) return;
            
            // æ›´æ–°æ ‡ç­¾é¡µæ ‡é¢˜
            tab.element.querySelector('.tab-title').textContent = tabData.remark;
            
            // æ›´æ–°æ ‡ç­¾é¡µæ•°æ®
            tab.data = tabData;
        }

        // æ˜¾ç¤ºè®¾ç½®æ¨¡æ€æ¡†
        async function showSettingsModal() {
            console.log('å¼€å§‹æ˜¾ç¤ºè®¾ç½®æ¨¡æ€æ¡†');
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'settingsModal';
            
            // è·å–å½“å‰æ ‡ç­¾é¡µæ•°æ®
            const currentTab = tabs.find(tab => tab.id === activeTabId);
            if (!currentTab) {
                console.error('æ²¡æœ‰æ‰¾åˆ°å½“å‰æ´»åŠ¨æ ‡ç­¾é¡µ');
                return;
            }
            console.log('å½“å‰æ ‡ç­¾é¡µæ•°æ®:', currentTab.data);
            console.log('å½“å‰æ ‡ç­¾é¡µ service å­—æ®µ:', currentTab.data.service, 'ç±»å‹:', typeof currentTab.data.service);

            // è·å–æœåŠ¡æ•°æ®
            let services = [];
            try {
                console.log('å¼€å§‹è¯»å–æœåŠ¡æ•°æ®');
                const serviceData = await window.electronAPI.readServiceData();
                console.log('è¯»å–åˆ°çš„æœåŠ¡æ•°æ®:', serviceData);
                services = serviceData.services || [];
                console.log('å¤„ç†åçš„æœåŠ¡åˆ—è¡¨:', services);
            } catch (error) {
                console.error('è¯»å–æœåŠ¡æ•°æ®å¤±è´¥:', error);
            }

            // ç”Ÿæˆé€‰é¡¹HTML
            const optionsHtml = services.map(service => {
                console.log('å¤„ç†æœåŠ¡é¡¹:', service);
                // ç¡®ä¿ç±»å‹åŒ¹é…
                const serviceId = String(service.id);
                const currentService = String(currentTab.data.service);
                const isSelected = currentTab.data.service && currentService === serviceId;
                console.log('æ¯”è¾ƒ:', {
                    serviceId,
                    currentService,
                    isSelected
                });
                return `<option value="${serviceId}" ${isSelected ? 'selected' : ''}>${service.group}</option>`;
            }).join('');
            console.log('ç”Ÿæˆçš„é€‰é¡¹HTML:', optionsHtml);

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>è®¾ç½®</h2>
                    </div>
                    <div class="form-item">
                        <label for="sceneSelect">é€‰æ‹©åœºæ§</label>
                        <select id="sceneSelect">
                            <option value="">è¯·é€‰æ‹©åœºæ§</option>
                            ${optionsHtml}
                        </select>
                    </div>
                    <div class="button-group">
                        <button class="btn" onclick="cancelSettings()">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            console.log('è®¾ç½®æ¨¡æ€æ¡†å·²æ·»åŠ åˆ°é¡µé¢');

            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeSettingsModal();
                }
            });
        }

        // ä¿å­˜è®¾ç½®
        async function saveSettings() {
            console.log('ä¿å­˜è®¾ç½®');
            const scene = document.getElementById('sceneSelect').value;
            
            if (window.electronAPI) {
                // è·å–å½“å‰æ ‡ç­¾é¡µæ•°æ®
                const currentTab = tabs.find(tab => tab.id === activeTabId);
                if (!currentTab) {
                    console.error('æ²¡æœ‰æ‰¾åˆ°å½“å‰æ´»åŠ¨æ ‡ç­¾é¡µ');
                    return;
                }

                // æ›´æ–°æ ‡ç­¾é¡µæ•°æ®
                const updatedTab = {
                    ...currentTab.data,
                    // å¦‚æœé€‰æ‹©çš„æ˜¯ç©ºå€¼ï¼Œåˆ™è®¾ç½® service ä¸º null
                    service: scene || null
                };

                // ä¿å­˜æ›´æ–°åçš„æ ‡ç­¾é¡µæ•°æ®
                await window.electronAPI.updateTab(updatedTab);
                
                // æ›´æ–°æœ¬åœ°æ ‡ç­¾é¡µæ•°æ®
                updateTab(updatedTab);
                
                closeSettingsModal();
            }
        }

        // å–æ¶ˆè®¾ç½®
        function cancelSettings() {
            console.log('å–æ¶ˆè®¾ç½®');
            closeSettingsModal();
        }

        // å…³é—­è®¾ç½®æ¨¡æ€æ¡†
        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.remove();
            }
        }

        // åˆ›å»ºæ–°çš„ webview å…ƒç´ 
        function createWebviewElement(tabData) {
            const webview = document.createElement('webview');
            webview.setAttribute('src', `https://zs.kwaixiaodian.com/page/helper?from=seller_pc_home_page&tabId=${tabData.id}`);
            webview.setAttribute('partition', `persist:${tabData.id}`);
            webview.setAttribute('webpreferences', 'contextIsolation=yes, nodeIntegration=yes');
            webview.setAttribute('allowpopups', '');
            webview.setAttribute('preload', './preload.js');
            webview.setAttribute('id', tabData.id);
            webview.setAttribute('class', 'webview');
            // ç§»é™¤é»˜è®¤çš„ display: none æ ·å¼
            return webview;
        }
    </script>
</body>
</html> 